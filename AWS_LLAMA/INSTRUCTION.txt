
DEPLOYMENT INSTRUCTIONS FOR ONCOLIFE (AWS ENTERPRISE EDITION)
=============================================================

ARCHITECTURE: OPTION 3 (Server-Side Logic + DynamoDB Persistence)
-----------------------------------------------------------------
This version implements a "Neuro-Symbolic" architecture:
1. React Frontend: Dumb UI (Displays questions, sends answers).
2. AWS Lambda: The Brain (Holds the Medical Protocols & Logic).
3. AWS Bedrock (Llama 3): The Translator (Classifies user text into strict options).
4. DynamoDB: The Memory (Stores session state).
5. Uses Amazon Amplify for hosting  

----------------------------------------------------
PART 1: INFRASTRUCTURE SETUP
----------------------------------------------------

1. **DYNAMODB TABLE**
   - Go to AWS Console -> DynamoDB -> Create Table.
   - Table Name: `OncoLifeSessions`
   - Partition Key: `session_id` (String)
   - Sort Key: (Leave empty)
   - Capacity: On-demand is recommended for development.

2. **AWS BEDROCK**
   - Go to Bedrock Console -> Model access.
   - Ensure "Llama 3 70B Instruct" is enabled (Region: us-east-1 recommended).

----------------------------------------------------
PART 2: DEPLOYING THE BACKEND (LAMBDA)
----------------------------------------------------
1. Navigate to the 'AWS_LLAMA/backend' folder.
2. **CRITICAL STEP**: 
   - Rename the file `lambda_function.txt` to `lambda_function.py`.
   - The file was provided as .txt to avoid local execution errors, but AWS needs .py.
3. Create a deployment package:
   - Create a new folder named `package`.
   - Open terminal in `backend` folder.
   - Run: `pip install --target ./package -r requirements.txt`
   - Copy the renamed `lambda_function.py` into the `package` folder.
   - Zip the contents of the `package` folder (Select all files inside -> Right Click -> Compress/Zip).
4. Create Lambda Function in AWS:
   - Runtime: Python 3.9 (or newer).
   - Handler: `lambda_function.lambda_handler` (Default).
   - Upload the Zip file you just created.
5. **PERMISSIONS (Crucial)**
   - Go to Configuration -> Permissions -> Execution Role -> Edit.
   - Add permissions to allow:
     a. `bedrock:InvokeModel`
     b. `dynamodb:GetItem`
     c. `dynamodb:PutItem`
6. **ENVIRONMENT VARIABLES**
   - Go to Configuration -> Environment variables.
   - Add Key: `TABLE_NAME` | Value: `OncoLifeSessions`
7. **FUNCTION URL**
   - Go to Configuration -> Function URL.
   - Create function URL (Auth type: NONE for initial testing).
   - **COPY THIS URL**. You need it for the frontend.

----------------------------------------------------
PART 3: DEPLOYING THE FRONTEND
----------------------------------------------------
1. Go to 'AWS_LLAMA/frontend' folder.
2. Create a file named `.env`:
   - Content: `VITE_AWS_API_URL=https://<YOUR_COPIED_LAMBDA_URL>`
3. Install & Build:
   - Run `npm install`
   - Run `npm run build`
4. Deploy:
   - Upload the contents of the `dist` folder to AWS Amplify, S3 (Static Hosting), or Vercel.

----------------------------------------------------
PART 4: VERIFICATION
----------------------------------------------------
- After deployment, open the website.
- Start a chat.
- Go to AWS DynamoDB Console -> Tables -> OncoLifeSessions -> Explore Table items.
- You should see a new entry with your `session_id`.
- If you refresh the page, the Frontend should now retrieve the same session ID from localStorage and allow you to continue (provided you implement history fetching in Lambda, otherwise it simply maintains the ID for consistent tracking).




Amazon Amplify 


Log into the AWS Management Console and search for AWS Amplify.

Select Amplify Hosting and click Create new app (or Host web app).

Choose GitHub as your service provider and click Next.

Authorize AWS to access your GitHub account.

From the dropdown, select your repository and the main branch, then click Next.

Step 3: Configure Build & Environment Variables (Critical for Vite)
Amplify will auto-detect your project as a Vite app, but you must manually inject your Lambda URL so it's available during the build process.

Environment Variables: On the "Build settings" page, click Environment variables.

Key: VITE_AWS_API_URL

Value: (Paste your Lambda Function URL).

Edit Build Settings (YAML): Click Edit on the build specification and update the build phase. Vite requires variables to be explicitly passed during the build command. Update your YAML to look like this:

YAML


frontend:
  phases:
    preBuild:
      commands:
        - npm ci
    build:
      commands:
        # This line ensures your Lambda URL is baked into the build
        - echo "VITE_AWS_API_URL=$VITE_AWS_API_URL" >> .env
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'



Click Next, review your settings, and click Save and deploy.

Step 4: Verify Deployment
Amplify will show three stages: Provision, Build, and Deploy.

Once finished, click the Visit deployed URL link provided in the console.

Final Step: Go back to your AWS Lambda Console > Configuration > Function URL and update the CORS Allowed Origin from * to your new Amplify URL (e.g., https://main.d123.amplifyapp.com) for better security.
